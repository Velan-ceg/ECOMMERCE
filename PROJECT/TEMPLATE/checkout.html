{% extends "base.html" %}
{% block title %}Checkout{% endblock %}
{% block content %}
<style>
  h2 { text-align:center; margin-bottom: 20px; }
  form { max-width: 500px; margin: 0 auto; display: flex; flex-direction: column; gap: 12px; }
  label { font-weight: 600; }
  input { padding: 8px; border-radius: 6px; border: 1px solid #ccc; }
  .checkout-btn {
    background: #0b5cff;
    color: white;
    border: none;
    padding: 10px;
    border-radius: 6px;
    font-weight: 600;
    cursor: pointer;
  }
  .checkout-btn:hover {
    background: #0840b3;
  }
  .confirm-btn {
    background: #43a047;
    color: white;
    padding: 10px 20px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 600;
  }
  .confirm-btn:hover {
    background: #2e7d32;
  }
  .success {
    text-align: center;
    margin-top: 40px;
  }
</style>

<h2>Checkout</h2>

{% if success %}
  <div class="success">
    <h3>✅ Order placed successfully!</h3>
    <p>Your order ID is <strong>#{{ order_id }}</strong></p>
    <button class="confirm-btn" onclick="confirmDelivery({{ order_id }})">
      Confirm Delivery
    </button>
  </div>
{% else %}
  <form method="POST">
    <label>Address Line:</label>
    <input type="text" name="line1" required>

    <label>City:</label>
    <input type="text" name="city" required>

    <label>State:</label>
    <input type="text" name="state" required>

    <label>Postal Code:</label>
    <input type="text" name="postal" required>

    <button type="submit" class="checkout-btn">Confirm Order</button>
  </form>
{% endif %}

<script>
async function confirmDelivery(orderId) {
  const res = await fetch(`/order/${orderId}/confirm`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' }
  });

  const data = await res.json();
  if (data.ok) {
    alert('✅ Delivery confirmed!');
    location.href = '/'; 
  } else {
    alert('❌ Failed to confirm delivery. Try again.');
  }
}
</script>

{% endblock %}
